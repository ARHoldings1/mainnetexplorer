<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy Contract</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <%- include('partials/header', {title: 'Deploy Contract'}) %>

    <main class="container">
        <h1>Deploy Contract</h1>
        <form id="deployForm">
            <div class="form-group">
                <label for="contractCode">Contract Code:</label>
                <textarea id="contractCode" rows="10" cols="50" placeholder="Paste your contract code here" required></textarea>
            </div>
            <button type="submit" class="btn">Deploy</button>
        </form>
        <div id="result"></div>
    </main>

    <%- include('partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script>
        const form = document.getElementById('deployForm');
        const resultDiv = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const code = document.getElementById('contractCode').value;
            
            try {
                const web3 = new Web3('http://54.92.173.128:8545'); // Use your Dot Protocol RPC URL
                const accounts = await web3.eth.getAccounts();

                const contract = new web3.eth.Contract(JSON.parse(code));
                const deploy = contract.deploy({data: '0x' + code});
                const gas = await deploy.estimateGas();

                const deployedContract = await deploy.send({
                    from: accounts[0],
                    gas
                });

                resultDiv.innerHTML = `Contract deployed at: ${deployedContract.options.address}`;
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>
